#!/usr/bin/env python3
"""Add a directory to Claude Code's trusted projects in ~/.claude.json."""

import json
import os
import sys

if len(sys.argv) != 2:
    print(f"Usage: {sys.argv[0]} <directory>", file=sys.stderr)
    sys.exit(1)

config_file = os.path.expanduser("~/.claude.json")
directory = os.path.realpath(sys.argv[1])

if os.path.exists(config_file):
    with open(config_file, "r") as f:
        data = json.load(f)
else:
    data = {}

if "projects" not in data:
    data["projects"] = {}

if directory not in data["projects"]:
    data["projects"][directory] = {"hasTrustDialogAccepted": True}
elif not data["projects"][directory].get("hasTrustDialogAccepted"):
    data["projects"][directory]["hasTrustDialogAccepted"] = True
else:
    sys.exit(0)

with open(config_file, "w") as f:
    json.dump(data, f, indent=2)
    f.write("\n")
os.chmod(config_file, 0o600)
