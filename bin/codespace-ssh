#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../lib/codespace_selector'

def main
  codespace_name = begin
    CodespaceSelector.select_codespace(codespace_name: ARGV[0])
  rescue CodespaceSelector::SelectionError => e
    puts "Error: #{e.message}"
    exit 1
  end

  puts "==> Connecting to Codespace: #{codespace_name}"
  puts ""

  system("gh codespace ssh -c #{codespace_name}")
  ssh_exit_code = $?.exitstatus

  puts "\n==> Disconnected from codespace: #{codespace_name}"
  puts "To reconnect run: codespace-ssh #{codespace_name}"

  exit ssh_exit_code
end

main
